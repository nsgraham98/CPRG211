@page "/addUpdateProduct"
@page "/updateProduct/{prodId:int}"

@using DemoMod9SQLiteWithoutExtension.Data
@using DemoMod9SQLiteWithoutExtension.Services
@inject ProductService prodService
@inject NavigationManager navManager

<h3>Add Update Product </h3>
<div class="row">
	<div class="col-md-6">
		<div class="mb-3">
			<label class="form-label">Product ID:</label>
			<input type="text" @bind="productId" class="form-control" placeholder="Product ID" readonly />
		</div>
		<div class="mb-3">
			<label class="form-label">Product Name:</label>
			<input type="text" @bind="productName" class="form-control" placeholder="Product Name" />
		</div>
		<div class="mb-3">
			<label class="form-label">Product Qty:</label>
			<input type="text" @bind="prodQty" class="form-control" placeholder="Product Quantity" />
		</div>
		<div class="mb-3">
			<label class="form-label">Product Price:</label>
			<input type="text" @bind="prodPrice" class="form-control" placeholder="Product Price" />
		</div>
		<button type="submit" class="btn btn-sm btn-success" @onclick="AddProductInfo">Submit</button>
		<button type="submit" class="btn btn-sm btn-info" @onclick="BackToList">Back</button>
	</div>
</div>

@code {
	// receives prodId from @page "/updateProduct/{prodId:int}" at top
	[Parameter]
	int ProductId { get; set; }

	int productId = 0;
	string productName = "";
	int prodQty = 0;
	int prodPrice = 0;

	protected override async void OnInitialized()
	{
		base.OnInitialized();
		productId = ProductId; // ProductId id the parameter we passed
		if(productId > 0)
		{
			var response = await prodService.GetProductAsync(productId);
			productName = response.Name;
			prodQty = response.Quantity;
			prodPrice = response.Price;
			this.StateHasChanged();
		}
	}

	public async void AddProductInfo()
	{
		var prod = new ProductInfo();
		prod.ProdId = productId;
		prod.Name = productName;
		prod.Quantity = prodQty;
		prod.Price = prodPrice;

		var response = await prodService.AddUpdateProductAsync(prod);
		if (response)
		{
			//insert
			if (productId == 0)
			{
				await App.Current.MainPage.DisplayAlert("Product Saved", "Insert Successful", "OK");
			}
			//update
			else
			{
				await App.Current.MainPage.DisplayAlert("Product Updated", "Update Successful", "OK");
			}
			navManager.NavigateTo("prodList");
		}
	}

	public void BackToList()
	{
		navManager.NavigateTo("prodList");
	}
}
